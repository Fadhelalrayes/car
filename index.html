<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Ø¥Ù†Ø´Ø§Ø¡ Ø±ØµÙŠØ¯ Ø§Ø³ØªÙ„Ø§Ù… ÙÙˆØ±ÙŠ â€” Ø¹Ø±Ø¨ÙŠ</title>
<meta name="description" content="Ø£Ù†Ø´Ø¦ Ø±ØµÙŠØ¯ Ø§Ø³ØªÙ„Ø§Ù… ÙÙˆØ±ÙŠ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©: ØªØ¹Ø¨Ø¦Ø© Ø³Ø±ÙŠØ¹Ø©ØŒ ØªÙˆÙ‚ÙŠØ¹ ÙŠØ¯ÙˆÙŠØŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø®ØªÙ… Ø§Ù„Ù…Ø¤Ø³Ø³Ø©ØŒ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ù† Ø£Ø±Ù‚Ø§Ù… Ø¥Ù„Ù‰ Ø­Ø±ÙˆÙ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ØŒ Ø·Ø¨Ø§Ø¹Ø©/ØªÙ†Ø²ÙŠÙ„/Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±ØµÙŠØ¯ ÙƒÙ…Ù„Ù PDF.">
<meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1">
<link rel="canonical" href="https://example.com/instant-receipt-ar" />
<meta property="og:title" content="Ø¥Ù†Ø´Ø§Ø¡ Ø±ØµÙŠØ¯ Ø§Ø³ØªÙ„Ø§Ù… ÙÙˆØ±ÙŠ â€” Ø¹Ø±Ø¨ÙŠ">
<meta property="og:description" content="ØªÙˆÙ‚ÙŠØ¹ ÙŠØ¯ÙˆÙŠØŒ Ø®ØªÙ… Ø§Ù„Ù…Ø¤Ø³Ø³Ø©ØŒ ÙˆØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¥Ù„Ù‰ Ø­Ø±ÙˆÙ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§. ØªÙ†Ø²ÙŠÙ„ ÙˆØ·Ø¨Ø§Ø¹Ø© ÙˆÙ…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±ØµÙŠØ¯ ÙƒÙ€ PDF.">
<meta property="og:type" content="website">
<meta property="og:locale" content="ar_AR">
<meta property="og:url" content="https://example.com/instant-receipt-ar">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ø¥Ù†Ø´Ø§Ø¡ Ø±ØµÙŠØ¯ Ø§Ø³ØªÙ„Ø§Ù… ÙÙˆØ±ÙŠ â€” Ø¹Ø±Ø¨ÙŠ">
<meta name="twitter:description" content="Ø±ØµÙŠØ¯ Ø§Ø³ØªÙ„Ø§Ù… Ø§Ø­ØªØ±Ø§ÙÙŠ Ù…Ø¹ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¥Ù„Ù‰ Ø­Ø±ÙˆÙ ÙˆÙ…Ø´Ø§Ø±ÙƒØ© PDF.">

<!-- Ø£Ù…Ø§Ù† -->
<meta http-equiv="Content-Security-Policy" content="
  default-src 'self' https:;
  img-src 'self' data: blob: https:;
  script-src 'self' https://cdn.jsdelivr.net 'wasm-unsafe-eval';
  style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
  font-src https://fonts.gstatic.com;
  connect-src 'self';
  frame-ancestors 'none';
  base-uri 'self';
  form-action 'self';
  upgrade-insecure-requests
">

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800&display=swap" rel="stylesheet">

<style>
:root{--ink:#0f172a;--muted:#6b7280;--line:#e5e7eb;--brand:#0b0f19;--accent:#C6A14A;--paper:#fff;--stamp:#0a4ea6}
*{box-sizing:border-box;-webkit-print-color-adjust:exact;print-color-adjust:exact}
html,body{height:100%}
body{margin:0;background:#f2f4f8;color:var(--ink);font-family:"Cairo",system-ui}
.wrap{max-width:1100px;margin:auto;padding:12px;display:grid;gap:12px;grid-template-columns:minmax(300px,1fr) 1.2fr}
@media(max-width:980px){.wrap{grid-template-columns:1fr}}
.card{background:#fff;border:1px solid var(--line);border-radius:14px;box-shadow:0 6px 16px rgba(0,0,0,.04);overflow:hidden}
.hd{padding:12px 14px;background:linear-gradient(90deg,var(--brand),#1a2233);color:#fff;font-weight:800;text-align:center}
.bd{padding:12px}
label{display:block;font:700 13px/1 "Cairo";color:var(--muted);margin:10px 2px 6px}
input,select,textarea{width:100%;padding:12px;border:1px solid #dfe3ea;border-radius:12px;font-size:15px;background:#fff}
textarea{min-height:90px;resize:vertical}
small.help{color:var(--muted);display:block;margin-top:4px}
.grid{display:grid;gap:10px}
.g2{grid-template-columns:1fr 1fr}
@media(max-width:720px){.g2{grid-template-columns:1fr}}
.btns{display:flex;gap:8px;flex-wrap:wrap}
.btn{border:0;border-radius:12px;padding:11px 14px;font-weight:800;font-size:14px;cursor:pointer}
.btn.primary{background:var(--accent);color:#000}
.btn.ghost{background:#eef2f7;color:#0b0f19}

/* Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© */
.tools{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
.tool{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--line);background:#fff;border-radius:12px;padding:10px 12px;font-weight:800;cursor:pointer}

/* ÙˆØ±Ù‚Ø© Ø§Ù„Ø±ØµÙŠØ¯ */
.preview{padding:10px;background:#fafafa}
.viewport{width:100%;display:flex;justify-content:center;align-items:flex-start;overflow:auto}
.print-area{width:210mm;background:var(--paper);color:var(--ink);border:1px solid var(--line);border-radius:12px;box-shadow:0 10px 26px rgba(0,0,0,.06)}
.receipt{padding:16mm 16mm 14mm}
.rec-head{display:flex;align-items:center;justify-content:space-between;gap:10px;border-bottom:2px solid var(--line);padding-bottom:8px}
.brand .name{font-weight:800;font-size:18px;color:#111}
.brand .sub{font-size:12px;color:var(--muted)}
.rec-title{font-weight:800;font-size:18px}
.rec-meta{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px}
.meta-item{font-size:13px;color:#111;background:#fcfcfd;border:1px solid var(--line);border-radius:10px;padding:8px 10px}
.rec-body{margin-top:12px;border:1px solid var(--line);border-radius:12px;overflow:hidden}
.row{display:grid;grid-template-columns:160px 1fr}
.row .label{background:#fafafa;border-inline-end:1px solid var(--line);padding:10px;font-weight:700}
.row .val{padding:10px}
@media(max-width:520px){.row{grid-template-columns:1fr}.row .label{border-inline-end:none;border-bottom:1px solid var(--line)}}
.amount-box{display:flex;gap:10px;flex-wrap:wrap}
.amount-chip{border:1px solid var(--line);border-radius:10px;padding:8px 10px;font-weight:700}

/* Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ ÙÙˆÙ‚ Ø§Ù„Ø®ØªÙ… */
.rec-foot{display:flex;flex-direction:column;gap:12px;align-items:stretch;margin-top:14px}
.sign{min-height:90px;border:1px dashed #cbd5e1;border-radius:10px;padding:8px}
#sigCanvas{width:100%;height:90px;touch-action:none;background:#fff;border:1px solid #e5e7eb;border-radius:10px}
#sigImg{max-height:86px;max-width:100%;display:block;object-fit:contain}
.stamp{min-height:90px;border:2px solid var(--stamp);border-radius:10px;padding:8px;font-size:12px;color:var(--stamp);font-weight:800;background:#fff}
.stamp .who{margin-top:6px;border-top:2px solid var(--stamp);padding-top:4px;font-size:11px}

.note{margin-top:10px;font-size:12.5px;color:#555;background:#fff8e6;border:1px solid rgba(198,161,74,.5);border-radius:10px;padding:10px}

/* Ø´Ø±ÙŠØ· Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø¨ÙƒØ§Øª */
.share-site{max-width:1100px;margin:6px auto 8px;padding:6px 12px}
.share-box{border:1px solid var(--line);background:#fff;border-radius:14px;box-shadow:0 6px 16px rgba(0,0,0,.04);padding:12px;text-align:center}
.share-title{font:800 15px/1 "Cairo";margin:0 0 10px;color:#111}
.icon-row{display:flex;justify-content:center;gap:14px;flex-wrap:wrap}
.icon-row a{display:inline-grid;place-items:center;width:42px;height:42px;border-radius:50%;text-decoration:none;border:1px solid var(--line)}
.icon-row a svg{width:22px;height:22px}
.icon-row a:hover{transform:translateY(-2px)}

/* Ø·Ø¨Ø§Ø¹Ø©: ÙŠØ¸Ù‡Ø± Ø§Ù„Ø±ØµÙŠØ¯ ÙÙ‚Ø· */
@page{size:A4;margin:12mm}
@media print{
  .no-print{display:none !important}
  .share-site{display:none !important}
  .print-area{border:none;box-shadow:none;page-break-inside:avoid}
}
</style>
</head>
<body>

<header class="no-print" style="max-width:1100px;margin:8px auto 0;padding:0 12px">
  <h1 style="margin:6px 0 0;font-size:20px">Ø¥Ù†Ø´Ø§Ø¡ Ø±ØµÙŠØ¯ Ø§Ø³ØªÙ„Ø§Ù… ÙÙˆØ±ÙŠ</h1>
  <p style="margin:4px 0 10px;color:#4b5563">ØªÙˆÙ‚ÙŠØ¹ ÙŠØ¯ÙˆÙŠØŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø®ØªÙ… Ø§Ù„Ù…Ø¤Ø³Ø³Ø©ØŒ ÙˆØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¥Ù„Ù‰ Ø­Ø±ÙˆÙ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ â€” Ø¬Ø§Ù‡Ø² Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© ÙˆØªÙ†Ø²ÙŠÙ„/Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±ØµÙŠØ¯ ÙƒÙ€ PDF.</p>
</header>

<main class="wrap">
  <!-- Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ -->
  <section class="card no-print" aria-label="Ø¥Ù†Ø´Ø§Ø¡ Ø±ØµÙŠØ¯ Ø§Ø³ØªÙ„Ø§Ù… ÙÙˆØ±ÙŠ">
    <div class="hd">Ø¥Ù†Ø´Ø§Ø¡ Ø±ØµÙŠØ¯ Ø§Ø³ØªÙ„Ø§Ù… ÙÙˆØ±ÙŠ</div>
    <div class="bd">
      <div class="grid">
        <div><label>Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø©/Ø§Ù„Ø´Ø±ÙƒØ©</label><input id="inCompany" autocomplete="organization" placeholder="Ù…Ø«Ø§Ù„: Ø´Ø±ÙƒØ© Ø§Ù„Ø£ÙÙ‚ Ù„Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª"></div>
        <div class="g2">
          <div><label>Ø§Ù„Ù‡Ø§ØªÙ</label><input id="inPhone" inputmode="tel" autocomplete="tel" placeholder="33375858"></div>
          <div><label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label><input id="inAddr" autocomplete="address-level1" placeholder="Ø§Ù„Ù…Ù†Ø§Ù…Ø© â€“ Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†"></div>
        </div>
        <div class="g2">
          <div><label>Ø±Ù‚Ù… Ø§Ù„Ø±ØµÙŠØ¯</label><input id="inNo" placeholder="2025-0001"></div>
          <div><label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label><input id="inDate" type="date"></div>
        </div>
        <div><label>Ø§Ø³ØªÙ„Ù…Ù†Ø§ Ù…Ù†</label><input id="inFrom" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ / Ø§Ù„Ø¬Ù‡Ø©"></div>
        <div class="g2">
          <div><label>Ø§Ù„Ù…Ø¨Ù„Øº (Ø£Ø±Ù‚Ø§Ù…)</label><input id="inAmt" inputmode="decimal" placeholder="300"></div>
          <div>
            <label>Ø§Ù„Ø¹Ù…Ù„Ø©</label>
            <select id="inCur">
              <option value="Ø¯ÙŠÙ†Ø§Ø± Ø¨Ø­Ø±ÙŠÙ†ÙŠ">Ø¯ÙŠÙ†Ø§Ø± Ø¨Ø­Ø±ÙŠÙ†ÙŠ</option>
              <option value="Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</option>
              <option value="Ø¯Ø±Ù‡Ù… Ø¥Ù…Ø§Ø±Ø§ØªÙŠ">Ø¯Ø±Ù‡Ù… Ø¥Ù…Ø§Ø±Ø§ØªÙŠ</option>
              <option value="Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ</option>
            </select>
          </div>
        </div>
        <div><label>ÙˆØ°Ù„Ùƒ Ø¹Ù†</label><textarea id="inFor" placeholder="Ø³Ø¯Ø§Ø¯ Ù…Ø³ØªØ­Ù‚Ø§Øª ÙØ§ØªÙˆØ±Ø© Ø±Ù‚Ù… 145"></textarea></div>

        <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®ØªÙ… -->
        <div class="g2">
          <div><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¤Ø³Ø³Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø®ØªÙ…</label><input id="inStampName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¤Ø³Ø³Ø©"></div>
          <div><label>Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ (CR)</label><input id="inStampCR" placeholder="34234-2025"></div>
        </div>
        <div><label>Ù‡Ø§ØªÙ Ø§Ù„Ø®ØªÙ… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><input id="inStampPhone" placeholder="33375858"></div>

        <!-- ØªÙˆÙ‚ÙŠØ¹ ÙŠØ¯ÙˆÙŠ -->
        <div>
          <label>Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„ÙŠØ¯ÙˆÙŠ</label>
          <div style="border:1px dashed #cbd5e1;border-radius:12px;padding:8px;background:#fff">
            <canvas id="sigCanvas" aria-label="Ù…Ø³Ø§Ø­Ø© Ø±Ø³Ù… Ø§Ù„ØªÙˆÙ‚ÙŠØ¹"></canvas>
            <div class="btns" style="margin-top:8px">
              <button class="btn ghost" id="btnClearSig" type="button">Ù…Ø³Ø­ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹</button>
              <button class="btn primary" id="btnUseSig" type="button">Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªÙˆÙ‚ÙŠØ¹</button>
            </div>
            <small class="help">Ø§Ø±Ø³Ù… Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø¨Ø§Ù„Ù‚Ù„Ù…/Ø§Ù„Ù…Ø§ÙˆØ³ Ø«Ù… Ø§Ø¶ØºØ· "Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªÙˆÙ‚ÙŠØ¹".</small>
          </div>
        </div>

        <div class="btns" style="margin-top:6px">
          <button class="btn primary" id="btnDownload" type="button">ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯ PDF</button>
          <button class="btn ghost" id="btnPrint" type="button">Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø±ØµÙŠØ¯</button>
          <button class="btn ghost" id="btnSharePdf" type="button">Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±ØµÙŠØ¯</button>
          <button class="btn ghost" id="btnClear" type="button">Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© -->
  <section class="card" aria-label="Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©">
    <div class="hd no-print">Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</div>
    <div class="bd preview">
      <div class="tools no-print">
        <button class="tool" id="tPrint" type="button">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø±ØµÙŠØ¯</button>
        <button class="tool" id="tPdf" type="button">â¬‡ï¸ ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ø±ØµÙŠØ¯ PDF</button>
        <button class="tool" id="tSharePdf" type="button">ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±ØµÙŠØ¯</button>
      </div>
      <div class="viewport">
        <div class="print-area" id="printArea" aria-label="Ø±ØµÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…">
          <div class="receipt">
            <div class="rec-head">
              <div class="brand">
                <div class="name" id="outCompany">Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø©</div>
                <div class="sub"><span id="outPhone">â€”</span> â€¢ <span id="outAddr">â€”</span></div>
              </div>
              <div class="rec-title">Ø±ØµÙŠØ¯ Ø§Ø³ØªÙ„Ø§Ù…</div>
            </div>

            <div class="rec-meta">
              <div class="meta-item">Ø±Ù‚Ù… Ø§Ù„Ø±ØµÙŠØ¯: <strong id="outNo">â€”</strong></div>
              <div class="meta-item">Ø§Ù„ØªØ§Ø±ÙŠØ®: <strong id="outDate">â€”</strong></div>
            </div>

            <div class="rec-body" style="margin-top:12px">
              <div class="row"><div class="label">Ø§Ø³ØªÙ„Ù…Ù†Ø§ Ù…Ù†</div><div class="val" id="outFrom">â€”</div></div>
              <div class="row">
                <div class="label">Ø§Ù„Ù…Ø¨Ù„Øº</div>
                <div class="val">
                  <div class="amount-box">
                    <div class="amount-chip" id="outAmt">0.000</div>
                    <div class="amount-chip" id="outCur">Ø¯ÙŠÙ†Ø§Ø± Ø¨Ø­Ø±ÙŠÙ†ÙŠ</div>
                  </div>
                  <div id="outAmtTxt" style="margin-top:6px;color:#374151;font-size:13px">â€”</div>
                </div>
              </div>
              <div class="row"><div class="label">ÙˆØ°Ù„Ùƒ Ø¹Ù†</div><div class="val" id="outFor">â€”</div></div>
            </div>

            <div class="rec-foot">
              <!-- Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ ÙÙˆÙ‚ Ø§Ù„Ø®ØªÙ… -->
              <div class="sign">
                <img id="sigImg" alt="Ø§Ù„ØªÙˆÙ‚ÙŠØ¹">
              </div>
              <div class="stamp">
                <div class="who">
                  <div id="outStampName">Ø§Ø³Ù… Ø§Ù„Ù…Ø¤Ø³Ø³Ø©</div>
                  <div id="outStampCR">CR: â€”</div>
                  <div id="outStampPhone">Tel: â€”</div>
                </div>
              </div>
            </div>

            <div class="note">Ù‡Ø°Ø§ Ø§Ù„Ø±ØµÙŠØ¯ ØµØ§Ù„Ø­ ÙƒØ¥Ø«Ø¨Ø§Øª Ø§Ø³ØªÙ„Ø§Ù…. ÙŠÙØ±Ø¬Ù‰ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù‡.</div>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>

<section class="share-site no-print" aria-label="Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±ØµÙŠØ¯ Ø¹Ø¨Ø± Ø§Ù„Ø´Ø¨ÙƒØ§Øª">
  <div class="share-box">
    <h2 class="share-title">Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±ØµÙŠØ¯ Ø¹Ø¨Ø± Ø§Ù„Ø´Ø¨ÙƒØ§Øª</h2>
    <div class="icon-row" id="shareRow"></div>
  </div>
</section>

<!-- Ù…ÙƒØªØ¨Ø§Øª PDF -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script>
'use strict';
const $=id=>document.getElementById(id);

/* Ø¥Ø¯Ø®Ø§Ù„Ø§Øª */
const inCompany=$("inCompany"), inPhone=$("inPhone"), inAddr=$("inAddr"),
      inNo=$("inNo"), inDate=$("inDate"), inFrom=$("inFrom"),
      inAmt=$("inAmt"), inCur=$("inCur"), inFor=$("inFor"),
      inStampName=$("inStampName"), inStampCR=$("inStampCR"), inStampPhone=$("inStampPhone");

/* Ù…Ø®Ø±Ø¬Ø§Øª */
const outCompany=$("outCompany"), outPhone=$("outPhone"), outAddr=$("outAddr"),
      outNo=$("outNo"), outDate=$("outDate"), outFrom=$("outFrom"),
      outAmt=$("outAmt"), outCur=$("outCur"), outAmtTxt=$("outAmtTxt"),
      outFor=$("outFor"), outStampName=$("outStampName"), outStampCR=$("outStampCR"),
      outStampPhone=$("outStampPhone"), sigImg=$("sigImg");

/* Ø§Ù„ÙŠÙˆÙ… Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§ */
(function(){const t=new Date(),yyyy=t.getFullYear(),mm=String(t.getMonth()+1).padStart(2,'0'),dd=String(t.getDate()).padStart(2,'0');if(!inDate.value)inDate.value=`${yyyy}-${mm}-${dd}`;})();

/* ØªÙ†Ø¸ÙŠÙ Ù…Ø¯Ø®Ù„Ø§Øª */
function clean(s){return (typeof s==='string'?s:'').replace(/[<>]/g,'').replace(/[\u0000-\u001F\u007F]/g,'').slice(0,300).trim();}

/* Ø£Ø±Ù‚Ø§Ù… Ø¥Ù„Ù‰ Ø­Ø±ÙˆÙ (Ù…Ø¨Ø³Ù‘Ø· Ø­ØªÙ‰ Ù…Ù„Ø§ÙŠÙŠÙ†) */
const U=["","ÙˆØ§Ø­Ø¯","Ø§Ø«Ù†Ø§Ù†","Ø«Ù„Ø§Ø«Ø©","Ø£Ø±Ø¨Ø¹Ø©","Ø®Ù…Ø³Ø©","Ø³ØªØ©","Ø³Ø¨Ø¹Ø©","Ø«Ù…Ø§Ù†ÙŠØ©","ØªØ³Ø¹Ø©"];
const T=["","Ø¹Ø´Ø±Ø©","Ø¹Ø´Ø±ÙˆÙ†","Ø«Ù„Ø§Ø«ÙˆÙ†","Ø£Ø±Ø¨Ø¹ÙˆÙ†","Ø®Ù…Ø³ÙˆÙ†","Ø³ØªÙˆÙ†","Ø³Ø¨Ø¹ÙˆÙ†","Ø«Ù…Ø§Ù†ÙˆÙ†","ØªØ³Ø¹ÙˆÙ†"];
const TE=["Ø¹Ø´Ø±Ø©","Ø£Ø­Ø¯ Ø¹Ø´Ø±","Ø§Ø«Ù†Ø§ Ø¹Ø´Ø±","Ø«Ù„Ø§Ø«Ø© Ø¹Ø´Ø±","Ø£Ø±Ø¨Ø¹Ø© Ø¹Ø´Ø±","Ø®Ù…Ø³Ø© Ø¹Ø´Ø±","Ø³ØªØ© Ø¹Ø´Ø±","Ø³Ø¨Ø¹Ø© Ø¹Ø´Ø±","Ø«Ù…Ø§Ù†ÙŠØ© Ø¹Ø´Ø±","ØªØ³Ø¹Ø© Ø¹Ø´Ø±"];
const H=["","Ù…Ø§Ø¦Ø©","Ù…Ø§Ø¦ØªØ§Ù†","Ø«Ù„Ø§Ø«Ù…Ø§Ø¦Ø©","Ø£Ø±Ø¨Ø¹Ù…Ø§Ø¦Ø©","Ø®Ù…Ø³Ù…Ø§Ø¦Ø©","Ø³ØªÙ…Ø§Ø¦Ø©","Ø³Ø¨Ø¹Ù…Ø§Ø¦Ø©","Ø«Ù…Ø§Ù†Ù…Ø§Ø¦Ø©","ØªØ³Ø¹Ù…Ø§Ø¦Ø©"];
function two(n){if(n===0)return"";if(n<10)return U[n];if(n<20)return TE[n-10];const u=n%10,t=Math.floor(n/10);return (u?U[u]+" Ùˆ ":"")+T[t]}
function three(n){const h=Math.floor(n/100),r=n%100;return (H[h]?(H[h]+(r?" Ùˆ ":"")):"")+two(r)}
function chunkName(i,n){if(i===1){if(n===1)return"Ø£Ù„Ù";if(n===2)return"Ø£Ù„ÙØ§Ù†";if(n>=3&&n<=10)return"Ø¢Ù„Ø§Ù";return"Ø£Ù„Ù"}if(i===2){if(n===1)return"Ù…Ù„ÙŠÙˆÙ†";if(n===2)return"Ù…Ù„ÙŠÙˆÙ†Ø§Ù†";if(n>=3&&n<=10)return"Ù…Ù„Ø§ÙŠÙŠÙ†";return"Ù…Ù„ÙŠÙˆÙ†"}return""}
function numberToArabicWords(n){n=Math.floor(Math.abs(n));if(n===0)return"ØµÙØ±";const ch=[n%1000,Math.floor(n/1000)%1000,Math.floor(n/1e6)%1000];const parts=[];for(let i=ch.length-1;i>=0;i--){const c=ch[i];if(!c)continue;const w=three(c), nm=chunkName(i,c);parts.push(w+(nm?(" "+nm):""))}return parts.join(" Ùˆ ")}

/* ØªÙ†Ø³ÙŠÙ‚ Ù…Ø¨Ù„Øº */
function formatAmount(v){const num=Number(String(v).replace(/[^\d.]/g,''));return isNaN(num)?"0.000":num.toLocaleString('en-US',{minimumFractionDigits:3,maximumFractionDigits:3})}

/* ØªØ·Ø¨ÙŠÙ‚ */
function apply(){
  outCompany.textContent=clean(inCompany.value)||"Ø§Ø³Ù… Ø§Ù„Ø¬Ù‡Ø©";
  outPhone.textContent=clean(inPhone.value)||"â€”";
  outAddr.textContent=clean(inAddr.value)||"â€”";
  outNo.textContent=clean(inNo.value)||"â€”";
  outDate.textContent=inDate.value?new Date(inDate.value+"T00:00:00").toLocaleDateString("ar-EG"):"â€”";
  outFrom.textContent=clean(inFrom.value)||"â€”";

  outAmt.textContent=formatAmount(inAmt.value||"");
  outCur.textContent=inCur.value;

  const num=Number(String(inAmt.value||"").replace(/[^\d.]/g,'')); // ÙŠÙÙƒØªØ¨ Ø¨Ø§Ù„Ø­Ø±ÙˆÙ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
  outAmtTxt.textContent = (!isNaN(num) && num>=0)
    ? (numberToArabicWords(Math.round(num))+" "+inCur.value+" ÙÙ‚Ø· Ù„Ø§ ØºÙŠØ±")
    : "â€”";

  outFor.textContent=clean(inFor.value)||"â€”";

  outStampName.textContent=clean(inStampName.value)||"Ø§Ø³Ù… Ø§Ù„Ù…Ø¤Ø³Ø³Ø©";
  outStampCR.textContent="CR: "+(clean(inStampCR.value)||"â€”");
  outStampPhone.textContent="Tel: "+(clean(inStampPhone.value)||"â€”");
}

/* Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
["input","change"].forEach(ev=>{
  document.querySelectorAll("input,textarea,select").forEach(el=>el.addEventListener(ev,apply,{passive:true}));
});

/* ØªÙˆÙ‚ÙŠØ¹ Canvas */
const canvas=document.getElementById('sigCanvas'), ctx=canvas.getContext('2d');
function resizeCanvas(){const DPR=Math.min(window.devicePixelRatio||1,2);const w=canvas.clientWidth||canvas.parentElement.clientWidth;const h=90;canvas.width=w*DPR;canvas.height=h*DPR;ctx.setTransform(DPR,0,0,DPR,0,0);ctx.lineWidth=2.6;ctx.lineCap='round';ctx.strokeStyle='#111';ctx.fillStyle='#fff';ctx.fillRect(0,0,w,h)}
function P(e){const r=canvas.getBoundingClientRect(),t=e.touches?e.touches[0]:e;return{x:t.clientX-r.left,y:t.clientY-r.top}}
let draw=false;
function down(e){e.preventDefault();draw=true;const m=P(e);ctx.beginPath();ctx.moveTo(m.x,m.y)}
function move(e){if(!draw)return;e.preventDefault();const m=P(e);ctx.lineTo(m.x,m.y);ctx.stroke()}
function up(){draw=false}
canvas.addEventListener('mousedown',down);canvas.addEventListener('mousemove',move);window.addEventListener('mouseup',up);
canvas.addEventListener('touchstart',down,{passive:false});canvas.addEventListener('touchmove',move,{passive:false});canvas.addEventListener('touchend',up);

document.getElementById('btnClearSig').onclick=()=>{resizeCanvas();document.getElementById('sigImg').removeAttribute('src')};
document.getElementById('btnUseSig').onclick=()=>{document.getElementById('sigImg').src=canvas.toDataURL('image/png')};

/* PDF (Ø§Ù„Ø±ØµÙŠØ¯ ÙÙ‚Ø·) */
async function renderReceiptCanvas(){const src=document.getElementById('printArea');const clone=src.cloneNode(true);Object.assign(clone.style,{width:'210mm',transform:'none',boxShadow:'none',position:'static'});const holder=document.createElement('div');Object.assign(holder.style,{position:'fixed',left:'-10000px',top:'0',background:'#fff'});holder.appendChild(clone);document.body.appendChild(holder);const canvas=await html2canvas(clone,{scale:2,backgroundColor:'#ffffff',useCORS:true});document.body.removeChild(holder);return canvas}
async function makePDFBlob(){const {jsPDF}=window.jspdf;const c=await renderReceiptCanvas();const img=c.toDataURL('image/jpeg',0.96);const pdf=new jsPDF('p','mm','a4');pdf.addImage(img,'JPEG',0,0,210,297,'','FAST');return pdf.output('blob')}
async function downloadPDF(){const blob=await makePDFBlob();const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`receipt-${(clean(inNo.value)||'no')}.pdf`;a.click();URL.revokeObjectURL(url)}
async function sharePDF(){try{const blob=await makePDFBlob();const file=new File([blob],`receipt-${(clean(inNo.value)||'no')}.pdf`,{type:'application/pdf'});if(navigator.canShare&&navigator.canShare({files:[file]})){await navigator.share({title:'Ø±ØµÙŠØ¯ Ø§Ø³ØªÙ„Ø§Ù…',text:'Ù…Ù„Ù PDF Ù„Ù„Ø±ØµØ¯',files:[file]});}else{alert("Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø¨Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­. Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø´Ø¨ÙƒØ§Øª Ø£Ùˆ Ù†Ø²Ù‘Ù„ Ø§Ù„Ø±ØµÙŠØ¯ PDF.");}}catch(e){alert("ØªØ¹Ø°Ù‘Ø±Øª Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø¢Ù†.");}}

/* Ø£Ø²Ø±Ø§Ø± */
document.getElementById('btnPrint').onclick=()=>window.print();
document.getElementById('tPrint').onclick=()=>window.print();
document.getElementById('btnDownload').onclick=downloadPDF;
document.getElementById('tPdf').onclick=downloadPDF;
document.getElementById('btnSharePdf').onclick=sharePDF;
document.getElementById('tSharePdf').onclick=sharePDF;
document.getElementById('btnClear').onclick=()=>{if(!confirm("Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ØŸ"))return;document.querySelectorAll("input,textarea").forEach(el=>{if(el.type!=="date")el.value="";});document.getElementById('sigImg').removeAttribute('src');resizeCanvas();apply();};

/* Ø´Ø±ÙŠØ· Ø§Ù„Ø´Ø¨ÙƒØ§Øª: Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±ØµÙŠØ¯ */
function buildShareBar(){
  const url=encodeURIComponent(location.href);
  const text=encodeURIComponent('Ø¥Ù†Ø´Ø§Ø¡ Ø±ØµÙŠØ¯ Ø§Ø³ØªÙ„Ø§Ù… ÙÙˆØ±ÙŠ â€” Ø¹Ø±Ø¨ÙŠ');
  const row=document.getElementById('shareRow'); row.textContent='';
  const items=[
    {label:'ÙˆØ§ØªØ³Ø§Ø¨',href:`https://wa.me/?text=${text}%20${url}`,svg:'M16.6 14.4c-.2.6-1 1-1.6.7-1.8-.9-3.3-2.4-4.2-4.2-.3-.6.1-1.4.7-1.6l.8-.3c.3-.1.5 0 .7.3l.9 1.4c.2.3.1.6-.1.8l-.3.3c.6 1 1.5 1.8 2.5 2.5l.3-.3c.2-.2.5-.3.8-.1l1.4.9c.3.2.4.4.3.7l-.3.8ZM12 2a10 10 0 0 1 8.8 14.8L20 22l-5.2-.8A10 10 0 1 1 12 2Z'},
    {label:'ØªÙ„ØºØ±Ø§Ù…',href:`https://t.me/share/url?url=${url}&text=${text}`,svg:'M21.5 3.5 2.9 10.8c-1 .4-1 1.8 0 2.2l4.6 1.7 1.8 5.6c.3 1 1.6 1.2 2.2.3l2.7-3.5 5.1 3.7c.8.6 2 .2 2.2-.8l2.7-15.6c.2-1-1-1.8-2.3-1.1Z'},
    {label:'X',href:`https://twitter.com/intent/tweet?url=${url}&text=${text}`,svg:'M13.7 10.6 21 2h-1.7l-6.2 7.4L8.2 2H2l7.6 11L2 22h1.7l6.6-7.8L15.8 22H22l-8.3-11.4Z'},
    {label:'ÙÙŠØ³Ø¨ÙˆÙƒ',href:`https://www.facebook.com/sharer/sharer.php?u=${url}`,svg:'M22 12a10 10 0 1 0-11.6 9.9v-7H7.7V12h2.7V9.7c0-2.7 1.6-4.2 4-4.2 1.2 0 2.4.2 2.4.2v2.6h-1.4c-1.3 0-1.7.8-1.7 1.6V12h2.9l-.46 2.9h-2.4v7A10 10 0 0 0 22 12'},
    {label:'Ù„ÙŠÙ†ÙƒØ¯Ø¥Ù†',href:`https://www.linkedin.com/sharing/share-offsite/?url=${url}`,svg:'M4.98 3.5a2.5 2.5 0 1 1 0 5.001 2.5 2.5 0 0 1 0-5zM3 9h4v12H3zM9 9h3.8v1.6h.1c.5-.9 1.8-1.9 3.7-1.9 4 0 4.8 2.6 4.8 6v6H17v-5.3c0-1.3 0-3-1.9-3s-2.2 1.4-2.2 2.9V21H9z'},
    {label:'Ø§Ù„Ø¨Ø±ÙŠØ¯',href:`mailto:?subject=${encodeURIComponent('Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±ØµÙŠØ¯')}&body=${text}%0A${url}`,svg:'M3 6h18v12H3z'}
  ];
  for(const it of items){
    const a=document.createElement('a'); a.href=it.href; a.target="_blank"; a.rel="noopener"; a.setAttribute('aria-label',it.label);
    const svg=document.createElementNS('http://www.w3.org/2000/svg','svg'); svg.setAttribute('viewBox','0 0 24 24');
    const p=document.createElementNS('http://www.w3.org/2000/svg','path'); p.setAttribute('d',it.svg);
    svg.appendChild(p); a.appendChild(svg); row.appendChild(a);
  }
}

/* ØªØ´ØºÙŠÙ„ */
function onReady(){resizeCanvas();apply();buildShareBar();}
if(document.readyState!=="loading") onReady(); else document.addEventListener('DOMContentLoaded',onReady);
</script>
</body>
</html>
