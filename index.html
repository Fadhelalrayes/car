<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>تذكرتك | أرخص التذاكر</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --ink:#0f172a; --muted:#64748b; --line:#e5e7eb; --bg:#f8fafc; --card:#ffffff;
      --brand:#0ea5e9; --brand-2:#0284c7; --radius:16px; --ring:0 0 0 3px rgba(14,165,233,.25);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:'Cairo',system-ui,Segoe UI,Roboto,Arial,sans-serif}header{background:#fff;border-bottom:1px solid var(--line);position:sticky;top:0;z-index:20}
.container{max-width:900px;margin:0 auto;padding:14px}
.row{display:flex;align-items:center;gap:12px}
.logo{width:40px;height:40px;border-radius:12px;display:grid;place-items:center;background:radial-gradient(circle at 30% 30%, #7dd3fc, #0ea5e9);color:#fff;font-weight:900}
.title{font-size:22px;font-weight:900}

.searchbar{margin:12px auto 0;display:grid;gap:10px;grid-template-columns:1fr 1fr auto}
.fld{position:relative;background:var(--card);border:1px solid var(--line);border-radius:14px;padding:8px 10px}
.fld label{display:block;font-size:12px;color:var(--muted)}
.fld input{width:100%;border:0;outline:none;background:transparent;padding:6px 2px;font-size:15px;color:var(--ink)}
.btn{background:var(--brand);color:#fff;border:0;border-radius:12px;padding:12px 16px;font-weight:800;cursor:pointer}
.btn:hover{background:var(--brand-2)}

/* Dropdown panel */
.dropdown{position:absolute;inset-inline:0;top:100%;margin-top:6px;background:#fff;border:1px solid var(--line);border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.08);max-height:340px;overflow:auto;display:none}
.dropdown.open{display:block}
.section-title{position:sticky;top:0;background:#fff;font-size:12px;color:var(--muted);padding:8px 10px;border-bottom:1px solid var(--line)}
.item{padding:10px 12px;cursor:pointer;border-bottom:1px dashed #f1f5f9}
.item:hover{background:#f8fafc}
.code{font-weight:900;color:#0ea5e9;margin-inline-start:6px}

main{padding:16px 0}
.grid{display:grid;gap:14px}
.card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);padding:14px}

/* Results */
.results{display:flex;flex-direction:column;gap:10px}
.ticket{border:1px solid var(--line);border-radius:14px;padding:12px;background:#fff;display:flex;justify-content:space-between;align-items:center;gap:8px}
.meta{color:var(--muted);font-size:13px}
.price{font-weight:900}
.providers{display:grid;gap:10px;margin-top:10px}
@media(min-width:700px){.providers{grid-template-columns:repeat(3,1fr)}}
.prov{border:1px solid var(--line);border-radius:14px;padding:12px;background:#fff}
.prov a{display:inline-block;margin-top:8px;text-decoration:none;background:var(--brand);color:#fff;padding:8px 12px;border-radius:10px;font-weight:700}

footer{margin-top:18px;border-top:1px dashed var(--line);padding:14px 0}
.credit{display:flex;gap:8px;align-items:center;flex-wrap:wrap;color:var(--muted)}
.credit a{color:var(--brand-2);font-weight:800;text-decoration:none}
.credit a:hover{text-decoration:underline}

.small{font-size:12px;color:var(--muted)}

  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="row">
        <div class="logo">✈️</div>
        <div class="title">تذكرتك</div>
      </div><!-- From/To only with dropdowns -->
  <form id="searchForm" class="searchbar" onsubmit="event.preventDefault(); buildLinks();">
    <div class="fld" id="fromField">
      <label for="origin">من</label>
      <input id="origin" placeholder="اختر دولة أو مطار" autocomplete="off" onfocus="openDrop('from')" oninput="filterDrop('from')">
      <div class="dropdown" id="fromDrop"></div>
    </div>
    <div class="fld" id="toField">
      <label for="destination">إلى</label>
      <input id="destination" placeholder="اختر مطار" autocomplete="off" onfocus="openDrop('to')" oninput="filterDrop('to')">
      <div class="dropdown" id="toDrop"></div>
    </div>
    <button class="btn" type="submit">اعرض أرخص التذاكر</button>
  </form>
</div>

  </header>  <main class="container">
    <section class="card">
      <h4 style="margin:0 0 6px 0">التذاكر (من الأرخص إلى الأعلى)</h4>
      <p id="summary" class="small">أدخل "من" و"إلى" بالأعلى ثم اضغط الزر.</p>
      <div id="tickets" class="results"></div><div class="providers" id="providers"></div>
  <p class="small">الأسعار المؤكدة تظهر داخل مواقع الحجز نفسها. هذا الصندوق يمكنه عرض أسعار حقيقية إذا أضفت مفتاح API (انظر التعليق داخل الكود).</p>
</section>

<footer>
  <div class="credit">
    <span>برمجة وتطوير: <a href="https://api.whatsapp.com/send/?phone=97333375858&text&type=phone_number&app_absent=0&wame_ctl=1" target="_blank" rel="noopener">فاضل الريس</a></span>
  </div>
</footer>

  </main>  <script>
    // ==== بيانات الدول والمطارات (مختصرة) ====
    const DB = {
      "البحرين": [{c:"BAH", n:"المنامة"}],
      "السعودية": [{c:"RUH", n:"الرياض"},{c:"JED", n:"جدة"},{c:"DMM", n:"الدمام"},{c:"MED", n:"المدينة"}],
      "الإمارات": [{c:"DXB", n:"دبي"},{c:"AUH", n:"أبوظبي"},{c:"SHJ", n:"الشارقة"}],
      "قطر": [{c:"DOH", n:"الدوحة"}],
      "الكويت": [{c:"KWI", n:"الكويت"}],
      "عُمان": [{c:"MCT", n:"مسقط"}],
      "الأردن": [{c:"AMM", n:"عمّان"}],
      "لبنان": [{c:"BEY", n:"بيروت"}],
      "مصر": [{c:"CAI", n:"القاهرة"},{c:"HRG", n:"الغردقة"},{c:"SSH", n:"شرم الشيخ"}],
      "تركيا": [{c:"IST", n:"إسطنبول"},{c:"AYT", n:"أنطاليا"},{c:"TZX", n:"طرابزون"}],
      "جورجيا": [{c:"TBS", n:"تبليسي"},{c:"BUS", n:"باتومي"}],
      "أذربيجان": [{c:"GYD", n:"باكو"}],
      "اليونان": [{c:"ATH", n:"أثينا"}],
      "إيطاليا": [{c:"FCO", n:"روما"},{c:"MXP", n:"ميلانو"}],
      "فرنسا": [{c:"CDG", n:"باريس"}],
      "إسبانيا": [{c:"BCN", n:"برشلونة"},{c:"MAD", n:"مدريد"}],
      "المملكة المتحدة": [{c:"LHR", n:"لندن"}],
      "سويسرا": [{c:"ZRH", n:"زيورخ"},{c:"GVA", n:"جنيف"}]
    };

    const ALL_AIRPORTS = Object.values(DB).flat();

    const originInput = document.getElementById('origin');
    const destInput   = document.getElementById('destination');
    const fromDrop = document.getElementById('fromDrop');
    const toDrop   = document.getElementById('toDrop');

    // فتح القوائم
    function openDrop(which){
      closeDrops();
      if(which==='from'){buildFromDrop(); fromDrop.classList.add('open');}
      else {buildToDrop(); toDrop.classList.add('open');}
    }
    function closeDrops(){fromDrop.classList.remove('open'); toDrop.classList.remove('open');}
    document.addEventListener('click', (e)=>{
      if(!e.target.closest('.fld')) closeDrops();
    });

    // بناء قائمة "من": دول ثم مطاراتها
    function buildFromDrop(filter=""){
      fromDrop.innerHTML='';
      Object.keys(DB).forEach(country=>{
        const sec=document.createElement('div');
        sec.innerHTML = `<div class="section-title">${country}</div>`;
        fromDrop.appendChild(sec);
        DB[country]
          .filter(a => (country+" "+a.c+" "+a.n).includes(filter.trim()))
          .forEach(a=>{
            const it=document.createElement('div');
            it.className='item';
            it.textContent=`${a.n}`;
            const span=document.createElement('span'); span.className='code'; span.textContent=a.c; it.appendChild(span);
            it.onclick=()=>{originInput.value=`${a.c} – ${a.n}`; closeDrops(); destInput.focus();};
            fromDrop.appendChild(it);
          })
      });
    }

    // بناء قائمة "إلى": جميع المطارات فقط
    function buildToDrop(filter=""){
      toDrop.innerHTML='';
      const sec=document.createElement('div');
      sec.innerHTML = `<div class="section-title">المطارات</div>`;
      toDrop.appendChild(sec);
      ALL_AIRPORTS
        .filter(a => (a.c+" "+a.n).includes(filter.trim()))
        .forEach(a=>{
          const it=document.createElement('div');
          it.className='item';
          it.textContent=`${a.n}`;
          const span=document.createElement('span'); span.className='code'; span.textContent=a.c; it.appendChild(span);
          it.onclick=()=>{destInput.value=`${a.c} – ${a.n}`; closeDrops();};
          toDrop.appendChild(it);
        });
    }

    function filterDrop(which){
      const v=(which==='from'?originInput.value:destInput.value).trim();
      const f=v.split('–')[0]?.trim()||v;
      if(which==='from') buildFromDrop(f.toUpperCase()); else buildToDrop(f.toUpperCase());
    }

    function parseCode(v){if(!v) return ''; const code=(v.split('–')[0]||'').trim().toUpperCase(); return code.length===3?code:v.trim().toUpperCase();}

    // ====== مربّع التذاكر (الأرخص → الأعلى) ======
    async function buildLinks(){
      const origin=parseCode(originInput.value);
      const destination=parseCode(destInput.value);
      if(!origin||!destination){alert('رجاءً اختر: من / إلى');return;}

      document.getElementById('summary').innerHTML=`من <strong>${origin}</strong> إلى <strong>${destination}</strong>`;

      // --- (اختياري) جلب أسعار حقيقية عبر API ---
      // للدعم الفعلي: ضع مفتاح Tequila (Kiwi) أو Amadeus هنا، ثم أزل التعليق عن fetchTickets()
      // const tickets = await fetchTickets_Tequila(origin, destination);
      const tickets = null; // اتركه null إن لم تملك API الآن

      renderTickets(tickets, origin, destination);
      renderProviderLinks(origin, destination);
    }

    function renderTickets(tickets, origin, destination){
      const box=document.getElementById('tickets');
      box.innerHTML='';
      if(Array.isArray(tickets) && tickets.length){
        tickets.sort((a,b)=>a.price-b.price);
        tickets.forEach(t=>{
          const el=document.createElement('div'); el.className='ticket';
          el.innerHTML=`<div><div><strong>${t.carrier||'شركة طيران'}</strong> • <span class="meta">${t.stops? t.stops+' توقف' : 'مباشر'}</span></div>
                          <div class="meta">المدة: ${t.duration||'-'} • الإقلاع: ${t.depart||'-'} • الوصول: ${t.arrive||'-'}</div></div>
                         <div class="price">${t.price} ${t.currency||'USD'}</div>`;
          if(t.link){
            const a=document.createElement('a'); a.className='btn'; a.style.padding='8px 10px'; a.style.textDecoration='none'; a.textContent='احجز'; a.href=t.link; a.target='_blank'; a.rel='noopener';
            el.appendChild(a);
          }
          box.appendChild(el);
        });
      } else {
        const el=document.createElement('div'); el.className='ticket';
        el.innerHTML = `<div class="meta">لإظهار الأسعار هنا مباشرةً، اربط مفتاح API (Kiwi/Amadeus). حالياً يمكنك فتح مواقع المقارنة أدناه.</div>`;
        box.appendChild(el);
      }
    }

    function renderProviderLinks(origin, destination){
      const box=document.getElementById('providers'); box.innerHTML='';
      const urls=[
        {name:'Google Flights', url:`https://www.google.com/travel/flights?hl=ar&q=${encodeURIComponent(`flights from ${origin} to ${destination}`)}`},
        {name:'Skyscanner', url:`https://www.skyscanner.net/transport/flights/${origin}/${destination}/?adults=1&cabinclass=economy`},
        {name:'KAYAK', url:`https://www.kayak.com/flights/${origin}-${destination}?sort=best`},
        {name:'Expedia', url:`https://www.expedia.com/Flights-Search?trip=oneway&leg1=from:${origin},to:${destination}&passengers=adults:1&mode=search`},
        {name:'Wego', url:`https://www.wego.com/flights/${origin}-${destination}`}
      ];
      urls.forEach(p=>{
        const card=document.createElement('div'); card.className='prov';
        card.innerHTML=`<strong>${p.name}</strong><a href="${p.url}" target="_blank" rel="noopener">افتح النتائج</a>`;
        box.appendChild(card);
      });
    }

    // ===== مثال توصيل حقيقي (Kiwi Tequila API) =====
    // 1) سجّل على https://tequila.kiwi.com للحصول على apikey
    // 2) ضع المفتاح في TEQUILA_API_KEY
    // 3) أزل التعليق عن استدعاء fetchTickets_Tequila في buildLinks()
    const TEQUILA_API_KEY = ""; // ضع مفتاحك هنا
    async function fetchTickets_Tequila(origin, destination){
      if(!TEQUILA_API_KEY) return null;
      const date = new Date();
      const dd = String(date.getDate()+7).padStart(2,'0');
      const mm = String(date.getMonth()+1).padStart(2,'0');
      const yyyy = date.getFullYear();
      const dateTo = String(date.getDate()+21).padStart(2,'0');
      const params = new URLSearchParams({
        fly_from: origin, fly_to: destination,
        date_from: `${dd}/${mm}/${yyyy}`, date_to: `${dateTo}/${mm}/${yyyy}`,
        curr: 'USD', partner: 'picky', limit: '10', sort: 'price'
      });
      const res = await fetch(`https://tequila-api.kiwi.com/v2/search?${params.toString()}`,{
        headers:{ 'apikey': TEQUILA_API_KEY }
      });
      if(!res.ok) return null;
      const data = await res.json();
      return (data.data||[]).map(x=>({
        price: x.price, currency: 'USD', carrier: (x.airlines||[])[0],
        duration: Math.round((x.duration?.total||0)/60)+' د',
        stops: (x.route?.length||1)-1,
        depart: new Date((x.route?.[0]?.dTimeUTC||0)*1000).toLocaleString('ar-EG'),
        arrive: new Date((x.route?.slice(-1)[0]?.aTimeUTC||0)*1000).toLocaleString('ar-EG'),
        link: x.deep_link
      }));
    }
  </script></body>
</html>
