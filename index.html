<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>تذكرتك</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    body{margin:0;background:#f8fafc;color:#0f172a;font-family:'Cairo',sans-serif}
    header{background:#fff;border-bottom:1px solid #e5e7eb}
    .container{max-width:880px;margin:0 auto;padding:16px}
    .row{display:flex;align-items:center;gap:12px}
    .logo{width:40px;height:40px;border-radius:12px;display:grid;place-items:center;background:#0ea5e9;color:#fff;font-weight:900}
    .title{font-size:22px;font-weight:900}
    .stack{display:grid;gap:14px;margin-top:12px}
    .fld{position:relative;background:#fff;border:2px solid #e5e7eb;border-radius:16px;padding:14px}
    .fld label{display:block;font-size:13px;color:#64748b;margin-bottom:6px}
    .fld input{width:100%;border:0;outline:none;background:transparent;padding:8px 2px;font-size:18px;color:#0f172a}
    .cta{width:100%;display:block;text-align:center;background:#0ea5e9;color:#fff;border:0;border-radius:16px;padding:16px 18px;font-weight:900;font-size:18px;cursor:pointer}
    .cta:hover{background:#0284c7}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:16px;padding:14px;margin-top:12px}
    .results{display:flex;flex-direction:column;gap:10px}
    .ticket{border:1px solid #e5e7eb;border-radius:14px;padding:12px;background:#fff;display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center}
    .ticket .meta{color:#64748b;font-size:13px}
    .ticket .price{font-weight:900;font-size:18px}
    footer{margin-top:18px;border-top:1px dashed #e5e7eb;padding:14px 0}
    .credit{display:flex;gap:8px;align-items:center;flex-wrap:wrap;color:#64748b}
    .credit a{color:#0284c7;font-weight:800;text-decoration:none}
    .credit a:hover{text-decoration:underline}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="row">
        <div class="logo">✈️</div>
        <div class="title">تذكرتك</div>
      </div><form id="searchForm" class="stack" onsubmit="event.preventDefault(); searchRSS();">
    <div class="fld">
      <label for="origin">من</label>
      <input id="origin" placeholder="مثال: BAH أو DXB">
    </div>
    <div class="fld">
      <label for="destination">إلى</label>
      <input id="destination" placeholder="مثال: CAI أو RUH">
    </div>
    <button class="cta" type="submit">🔎 ابحث عن العروض</button>
  </form>
</div>

  </header>  <main class="container">
    <section id="resultsCard" class="card" style="display:none">
      <h4 style="margin:0 0 6px 0">عروض الرحلات (RSS)</h4>
      <p id="summary" style="font-size:12px;color:#64748b">—</p>
      <div id="tickets" class="results"></div>
    </section><footer>
  <div class="credit">
    <span>برمجة وتطوير: <a href="https://api.whatsapp.com/send/?phone=97333375858&text&type=phone_number&app_absent=0&wame_ctl=1" target="_blank" rel="noopener">فاضل الريس</a></span>
  </div>
</footer>

  </main>  <script>
    const FEEDS = [
      {name:"SecretFlying", url:"https://www.secretflying.com/feed/"},
      {name:"TheFlightDeal", url:"https://www.theflightdeal.com/feed/"},
      {name:"Fly4free Global", url:"https://www.fly4free.com/feed/"}
    ];

    // بروكسي لتجاوز CORS
    const proxy = (u) => `https://api.allorigins.win/raw?url=${encodeURIComponent(u)}`;

    async function fetchRSS(url){
      const res = await fetch(proxy(url));
      const txt = await res.text();
      const doc = new window.DOMParser().parseFromString(txt, "text/xml");
      return [...doc.querySelectorAll("item")].map(it=>({
        title: it.querySelector("title")?.textContent||"",
        link: it.querySelector("link")?.textContent||"",
        pubDate: it.querySelector("pubDate")?.textContent||""
      }));
    }

    async function searchRSS(){
      const origin=document.getElementById('origin').value.toUpperCase();
      const destination=document.getElementById('destination').value.toUpperCase();
      const resultsCard=document.getElementById('resultsCard');
      const ticketsBox=document.getElementById('tickets');
      const summary=document.getElementById('summary');

      resultsCard.style.display='block';
      summary.textContent = `من ${origin||'أي'} إلى ${destination||'أي'} — نتائج من RSS`;
      ticketsBox.innerHTML='<div class="ticket"><div class="meta">جارٍ تحميل...</div></div>';

      let all=[];
      for(const f of FEEDS){
        try{
          const items=await fetchRSS(f.url);
          items.forEach(x=>all.push({...x,source:f.name}));
        }catch(e){console.log('فشل',f.url);}
      }

      const filtered=all.filter(it=>{
        const t=it.title.toUpperCase();
        if(origin && destination) return t.includes(origin)&&t.includes(destination);
        if(origin) return t.includes(origin);
        if(destination) return t.includes(destination);
        return true;
      });

      ticketsBox.innerHTML='';
      if(!filtered.length){ticketsBox.innerHTML='<div class="ticket"><div class="meta">لا توجد نتائج مطابقة الآن</div></div>';return;}

      filtered.slice(0,10).forEach(t=>{
        const el=document.createElement('div'); el.className='ticket';
        el.innerHTML=`
          <div>
            <div><strong>${t.title}</strong></div>
            <div class='meta'>${t.source} • ${t.pubDate}</div>
          </div>
          <a href='${t.link}' target='_blank' class='price'>افتح</a>`;
        ticketsBox.appendChild(el);
      });
    }
  </script></body>
</html>
