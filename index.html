<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø¢Ù† â€” Ù„ÙˆØ­Ø© Ø¹Ø±Ø¨ÙŠØ© Ø§Ø­ØªØ±Ø§ÙÙŠØ©</title>
<style>
  :root{
    --bg:#0b0b0c;
    --card:#15161a;
    --text:#e9eaee;
    --muted:#a7abbb;
    --brand:#4da3ff;
    --accent:#ffd166;
    --border:#22242a;
    --shadow: 0 10px 30px rgba(0,0,0,.25);
  }
  .light{
    --bg:#f7f8fb;
    --card:#ffffff;
    --text:#0f1222;
    --muted:#5a6072;
    --brand:#1e63ff;
    --accent:#ff8c00;
    --border:#e8ebf2;
    --shadow: 0 12px 28px rgba(16,24,40,.08);
  }
  *{box-sizing:border-box}
  body{
    margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Sans Arabic",sans-serif;
  }
  header{
    position:sticky;top:0;z-index:10;background:linear-gradient(180deg,var(--bg),color-mix(in oklab,var(--bg),transparent 30%));
    backdrop-filter:saturate(140%) blur(8px);border-bottom:1px solid var(--border);
  }
  .bar{
    max-width:1200px;margin:auto;display:flex;align-items:center;gap:12px;padding:14px 16px;
  }
  .logo{
    display:flex;align-items:center;gap:10px;font-weight:800;font-size:18px;letter-spacing:.2px;
  }
  .logo i{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,var(--brand),var(--accent));display:inline-block}
  .controls{flex:1;display:flex;align-items:center;gap:10px;flex-wrap:wrap}
  select, input, button{
    background:var(--card);color:var(--text);border:1px solid var(--border);
    padding:10px 12px;border-radius:10px;font:inherit;
  }
  input[type="search"]{flex:1;min-width:160px}
  button{cursor:pointer;box-shadow:var(--shadow);border:none}
  .chip{background:transparent;border:1px solid var(--border);box-shadow:none}
  .danger{background:#a61e4d}
  .ok{background:#176b49}
  .ghost{background:transparent;box-shadow:none;border:1px solid var(--border)}
  .grid{
    max-width:1200px;margin:20px auto;padding:0 16px;
    display:grid;gap:16px;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  }
  .card{
    background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;
    display:flex;flex-direction:column;min-height:320px;box-shadow:var(--shadow);transition:transform .08s ease;
  }
  .card:hover{transform:translateY(-2px)}
  .thumb{aspect-ratio:16/9;background:#0d0f14;object-fit:cover;width:100%}
  .content{padding:14px 14px 8px 14px;display:flex;flex-direction:column;gap:8px}
  .title{font-weight:700;line-height:1.3;font-size:16px}
  .meta{display:flex;gap:10px;flex-wrap:wrap;color:var(--muted);font-size:12px}
  .footer{margin-top:auto;padding:12px 14px;display:flex;justify-content:space-between;align-items:center;border-top:1px solid var(--border);color:var(--muted)}
  .skeleton{
    position:relative;overflow:hidden;background:linear-gradient(90deg,#1b1e27 25%,#222633 37%,#1b1e27 63%);
    background-size:400% 100%;animation:shimmer 1.2s infinite;
  }
  .sk-text{height:14px;border-radius:6px;margin:8px 0}
  .sk-img{aspect-ratio:16/9;border-bottom:1px solid var(--border)}
  @keyframes shimmer{0%{background-position:100% 0}100%{background-position:0 0}}
  .empty{
    max-width:800px;margin:60px auto;padding:24px;border:1px dashed var(--border);border-radius:14px;text-align:center;color:var(--muted)
  }
  .settings{
    position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;padding:20px
  }
  .settings .box{
    width:min(720px,95vw);background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:var(--shadow)
  }
  .row{display:flex;gap:10px;flex-wrap:wrap;margin:8px 0}
  .row label{font-size:13px;color:var(--muted)}
  .help{font-size:12px;color:var(--muted)}
  .badge{font-size:11px;border:1px solid var(--border);padding:3px 8px;border-radius:999px;color:var(--muted)}
  footer.site{
    max-width:1200px;margin:40px auto 80px;padding:0 16px;color:var(--muted);font-size:13px;display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap
  }
</style>
</head>
<body>
<header>
  <div class="bar">
    <div class="logo"><i></i> Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø¢Ù†</div>
    <div class="controls">
      <select id="provider" title="Ù…Ø²ÙˆØ¯ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±">
        <option value="newsapi">NewsAPI</option>
        <option value="gnews">GNews</option>
        <option value="newsdata">NewsData.io</option>
      </select>
      <select id="category" title="ØªØµÙ†ÙŠÙ">
        <option value="">ÙƒÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</option>
        <option value="general">Ø¹Ø§Ù…</option>
        <option value="business">Ø§Ù‚ØªØµØ§Ø¯</option>
        <option value="technology">ØªÙ‚Ù†ÙŠØ©</option>
        <option value="sports">Ø±ÙŠØ§Ø¶Ø©</option>
        <option value="health">ØµØ­Ø©</option>
        <option value="science">Ø¹Ù„ÙˆÙ…</option>
        <option value="entertainment">Ù…Ù†ÙˆØ¹Ø§Øª</option>
      </select>
      <input id="q" type="search" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± (Ù…Ø«Ø§Ù„: Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ)" />
      <button id="searchBtn">Ø¨Ø­Ø«</button>
      <button id="toggleTheme" class="ghost" title="Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†/Ø§Ù„ÙØ§ØªØ­">ğŸŒ“</button>
      <button id="openSettings" class="ghost" title="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª">âš™ï¸</button>
      <span class="badge" id="statusBadge">Ø¬Ø§Ù‡Ø²</span>
    </div>
  </div>
</header>

<main id="app">
  <div id="grid" class="grid"></div>
  <div id="empty" class="empty" style="display:none">
    Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©. Ø¬Ø±Ù‘Ø¨ ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ©/ØªØµÙ†ÙŠÙ Ù…Ø®ØªÙ„ÙÙ‹Ø§.
  </div>
</main>

<footer class="site">
  <div>Ù…ØµÙ…Ù… Ø¨ÙˆØ§Ø¬Ù‡Ø© Ø¹Ø±Ø¨ÙŠØ© Ø¹ØµØ±ÙŠØ©. ÙŠØ¯Ø¹Ù… ØªØ¹Ø¯Ø¯ Ù…Ø²ÙˆÙ‘Ø¯ÙŠ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±.</div>
  <div>ØªÙ„Ù…ÙŠØ­: Ø¥Ù† Ø¸Ù‡Ø±Øª Ù…Ø´ÙƒÙ„Ø© CORS Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­ØŒ ÙØ¹Ù‘Ù„ Ø®ÙŠØ§Ø± Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.</div>
</footer>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
<div class="settings" id="settings">
  <div class="box">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
      <h3 style="margin:6px 0">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
      <button id="closeSettings" class="ghost">âœ–</button>
    </div>
    <div class="row">
      <div style="flex:1 1 260px">
        <label>Ù…ÙØªØ§Ø­ API â€” NewsAPI.org</label>
        <input id="key-newsapi" placeholder="Ø£Ø¯Ø®Ù„ Ù…ÙØªØ§Ø­ NewsAPI" />
        <div class="help">Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙØªØ§Ø­ Ù…Ù† newsapi.org (Ø§Ø®ØªØ± language=ar)</div>
      </div>
      <div style="flex:1 1 260px">
        <label>Ù…ÙØªØ§Ø­ API â€” GNews</label>
        <input id="key-gnews" placeholder="Ø£Ø¯Ø®Ù„ Ù…ÙØªØ§Ø­ GNews" />
        <div class="help">Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙØªØ§Ø­ Ù…Ù† gnews.io (Ø§Ø®ØªØ± lang=ar)</div>
      </div>
      <div style="flex:1 1 260px">
        <label>Ù…ÙØªØ§Ø­ API â€” NewsData.io</label>
        <input id="key-newsdata" placeholder="Ø£Ø¯Ø®Ù„ Ù…ÙØªØ§Ø­ NewsData.io" />
        <div class="help">Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙØªØ§Ø­ Ù…Ù† newsdata.io</div>
      </div>
    </div>
    <div class="row">
      <div style="flex:1 1 260px">
        <label>Ø¨Ø±ÙˆÙƒØ³ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„ØªØ¬Ø§ÙˆØ² CORS)</label>
        <input id="proxy" placeholder="Ù…Ø«Ø§Ù„: https://api.allorigins.win/raw?url=" />
        <div class="help">Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºÙ‹Ø§ Ø¥Ù† Ù„Ù… ØªÙˆØ§Ø¬Ù‡ Ù…Ø´ÙƒÙ„Ø© CORS. Ø§Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ù‰ Ù…Ø³Ø¤ÙˆÙ„ÙŠØªÙƒ ÙˆØ§Ø­ØªØ±Ù… Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø¯Ù…Ø©.</div>
      </div>
      <div style="flex:0 0 220px;display:flex;align-items:flex-end">
        <button id="saveSettings" class="ok">Ø­ÙØ¸</button>
      </div>
    </div>
    <div class="row">
      <span class="help">ÙŠÙØ®Ø²Ù‘ÙÙ† ÙƒÙ„ Ù…Ø§ Ø³Ø¨Ù‚ Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ (LocalStorage).</span>
    </div>
  </div>
</div>

<script>
  // ========= ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© =========
  const themeBtn = document.getElementById('toggleTheme');
  const isLight = localStorage.getItem('theme') === 'light';
  if(isLight) document.body.classList.add('light');
  themeBtn.onclick = () => {
    document.body.classList.toggle('light');
    localStorage.setItem('theme', document.body.classList.contains('light') ? 'light' : 'dark');
  };

  // ========= Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… =========
  const grid = document.getElementById('grid');
  const empty = document.getElementById('empty');
  const providerSel = document.getElementById('provider');
  const catSel = document.getElementById('category');
  const qInput = document.getElementById('q');
  const searchBtn = document.getElementById('searchBtn');
  const statusBadge = document.getElementById('statusBadge');

  // ========= Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª =========
  const settings = document.getElementById('settings');
  const openSettings = document.getElementById('openSettings');
  const closeSettings = document.getElementById('closeSettings');
  const saveSettings = document.getElementById('saveSettings');
  const keyNewsapi = document.getElementById('key-newsapi');
  const keyGnews = document.getElementById('key-gnews');
  const keyNewsdata = document.getElementById('key-newsdata');
  const proxyInput = document.getElementById('proxy');

  openSettings.onclick = () => { settings.style.display='flex'; loadSettings(); };
  closeSettings.onclick = () => { settings.style.display='none'; };
  function loadSettings(){
    keyNewsapi.value = localStorage.getItem('key_newsapi') || '';
    keyGnews.value = localStorage.getItem('key_gnews') || '';
    keyNewsdata.value = localStorage.getItem('key_newsdata') || '';
    proxyInput.value = localStorage.getItem('proxy_base') || '';
  }
  saveSettings.onclick = () => {
    localStorage.setItem('key_newsapi', keyNewsapi.value.trim());
    localStorage.setItem('key_gnews', keyGnews.value.trim());
    localStorage.setItem('key_newsdata', keyNewsdata.value.trim());
    localStorage.setItem('proxy_base', proxyInput.value.trim());
    settings.style.display='none';
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø¨Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    resetAndSearch();
  };

  // ========= Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« / ØªØ±Ù‚ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª =========
  let page = 1;
  let loading = false;
  let done = false;

  function setStatus(text, type=''){
    statusBadge.textContent = text;
    statusBadge.style.borderColor = type==='err' ? '#a61e4d' : 'var(--border)';
    statusBadge.style.color = type==='err' ? '#ffb3c7' : 'var(--muted)';
  }

  // ========= Ù…Ø³Ø§Ø¹Ø¯Ø§Øª =========
  function fmtRelative(dateStr){
    try{
      const d = new Date(dateStr);
      const diff = (Date.now() - d.getTime())/1000;
      if(diff < 60) return 'Ø§Ù„Ø¢Ù†';
      if(diff < 3600) return `${Math.floor(diff/60)} Ø¯Ù‚ÙŠÙ‚Ø©`;
      if(diff < 86400) return `${Math.floor(diff/3600)} Ø³Ø§Ø¹Ø©`;
      const days = Math.floor(diff/86400);
      return `${days} ÙŠÙˆÙ…`;
    }catch(e){ return ''; }
  }

  function imgOrFallback(url){
    return url || 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(`
      <svg xmlns="http://www.w3.org/2000/svg" width="800" height="450">
        <rect width="100%" height="100%" fill="#10131a"/>
        <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="28" fill="#4da3ff" font-family="Arial, sans-serif">Ù„Ø§ ØµÙˆØ±Ø©</text>
      </svg>
    `);
  }

  function makeCard(a){
    const el = document.createElement('article');
    el.className = 'card';
    el.innerHTML = `
      <img class="thumb" loading="lazy" src="${imgOrFallback(a.image)}" alt="">
      <div class="content">
        <div class="title">${a.title || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†'}</div>
        <div class="meta">
          <span>ğŸ“° ${a.source || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</span>
          <span>â± ${a.published ? fmtRelative(a.published) : ''}</span>
        </div>
        <div style="color:var(--muted);font-size:13px;">${a.description || ''}</div>
      </div>
      <div class="footer">
        <a href="${a.url}" target="_blank" rel="noopener">ÙØªØ­ Ø§Ù„Ø®Ø¨Ø± â†—</a>
        <span>${a.category || ''}</span>
      </div>
    `;
    return el;
  }

  function makeSkeleton(){
    const el = document.createElement('div');
    el.className = 'card';
    el.innerHTML = `
      <div class="thumb skeleton sk-img"></div>
      <div class="content">
        <div class="skeleton sk-text" style="width:85%"></div>
        <div class="skeleton sk-text" style="width:60%"></div>
        <div class="skeleton sk-text" style="width:95%;height:36px;border-radius:10px"></div>
      </div>
      <div class="footer">
        <span class="skeleton sk-text" style="width:100px;height:10px;margin:0"></span>
        <span class="skeleton sk-text" style="width:60px;height:10px;margin:0"></span>
      </div>
    `;
    return el;
  }

  function showSkeletons(n=8){
    const fr = document.createDocumentFragment();
    for(let i=0;i<n;i++) fr.appendChild(makeSkeleton());
    grid.appendChild(fr);
  }

  function clearGrid(){ grid.innerHTML=''; }

  // ======== Ø®Ø±Ø§Ø¦Ø· Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ù„ÙƒÙ„ Ù…Ø²ÙˆÙ‘Ø¯ ========
  const categoryMap = {
    newsapi: { // https://newsapi.org/docs/endpoints/top-headlines
      general:'general',business:'business',technology:'technology',sports:'sports',health:'health',science:'science',entertainment:'entertainment'
    },
    gnews: { // https://gnews.io/docs/v4#parameters
      general:'general',business:'business',technology:'technology',sports:'sports',health:'health',science:'science',entertainment:'entertainment'
    },
    newsdata: { // https://newsdata.io/documentation
      general:'top',business:'business',technology:'technology',sports:'sports',health:'health',science:'science',entertainment:'entertainment'
    }
  };

  // ========= Ø¨Ù†Ø§Ø¡ URL Ø§Ù„Ø·Ù„Ø¨ Ù„ÙƒÙ„ Ù…Ø²ÙˆÙ‘Ø¯ =========
  function buildUrl(provider, pageNum, q, cat){
    const proxy = (localStorage.getItem('proxy_base') || '').trim();
    const enc = encodeURIComponent;
    let raw = '';
    if(provider==='newsapi'){
      const key = (localStorage.getItem('key_newsapi')||'').trim();
      raw = `https://newsapi.org/v2/top-headlines?language=ar&pageSize=20&page=${pageNum}`
          + (q ? `&q=${enc(q)}`:'')
          + (cat ? `&category=${enc(categoryMap.newsapi[cat]||'')}`:'')
          + `&apiKey=${enc(key)}`;
    }else if(provider==='gnews'){
      const key = (localStorage.getItem('key_gnews')||'').trim();
      raw = `https://gnews.io/api/v4/top-headlines?lang=ar&max=20&page=${pageNum}`
          + (q ? `&q=${enc(q)}`:'')
          + (cat ? `&topic=${enc(categoryMap.gnews[cat]||'')}`:'')
          + `&token=${enc(key)}`;
    }else if(provider==='newsdata'){
      const key = (localStorage.getItem('key_newsdata')||'').trim();
      raw = `https://newsdata.io/api/1/news?language=ar&page=${pageNum}`
          + (q ? `&q=${enc(q)}`:'')
          + (cat ? `&category=${enc(categoryMap.newsdata[cat]||'')}`:'')
          + `&apikey=${enc(key)}`;
    }
    return proxy ? proxy + encodeURIComponent(raw) : raw;
  }

  // ========= ØªÙˆØ­ÙŠØ¯ Ø´ÙƒÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ù…Ù† ÙƒÙ„ Ù…Ø²ÙˆÙ‘Ø¯ =========
  function normalize(provider, data){
    let items = [];
    if(provider==='newsapi'){
      // shape: { articles: [ {title, description, url, urlToImage, source:{name}, publishedAt} ] }
      items = (data.articles || []).map(x => ({
        title:x.title, description:x.description, url:x.url,
        image:x.urlToImage, source:x.source?.name, published:x.publishedAt
      }));
    }else if(provider==='gnews'){
      // shape: { articles: [ {title, description, url, image, source:{name}, publishedAt} ] }
      items = (data.articles || []).map(x => ({
        title:x.title, description:x.description, url:x.url,
        image:x.image, source:x.source?.name, published:x.publishedAt
      }));
    }else if(provider==='newsdata'){
      // shape: { results: [ {title, description, link, image_url, source_id, pubDate} ] }
      items = (data.results || []).map(x => ({
        title:x.title, description:x.description, url:x.link,
        image:x.image_url, source:x.source_id, published:x.pubDate
      }));
    }
    return items;
  }

  async function fetchNews(append=false){
    if(loading || done) return;
    loading = true;
    setStatus('ÙŠØ¬Ù„Ø¨ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±â€¦');
    showSkeletons(6);
    try{
      const provider = providerSel.value;
      const q = qInput.value.trim();
      const cat = catSel.value || '';
      const url = buildUrl(provider, page, q, cat);
      // Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø·Ù„Ø¨Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ù‡ÙŠØ£Ø©
      if(url.includes('apiKey=') && url.endsWith('apiKey=') ||
         url.includes('token=')  && url.endsWith('token=')  ||
         url.includes('apikey=') && url.endsWith('apikey=')){
        throw new Error('Ø£Ø¯Ø®Ù„ Ù…ÙØªØ§Ø­ API Ù„Ù„Ù…Ø²ÙˆÙ‘Ø¯ Ø§Ù„Ù…Ø®ØªØ§Ø± Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª âš™ï¸');
      }
      const res = await fetch(url);
      if(!res.ok){
        throw new Error(`ÙØ´Ù„ Ø§Ù„Ø¬Ù„Ø¨ (${res.status}) â€” Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ø­Ø¯ Ø§Ù„Ù…Ø¹Ø¯Ù‘Ù„ Ø£Ùˆ CORS.`);
      }
      const data = await res.json();
      const list = normalize(provider, data);
      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„ÙˆÙ‡Ù…ÙŠØ©
      grid.querySelectorAll('.card .sk-img, .card .sk-text').forEach(el => el.closest('.card')?.remove());

      if(!append) clearGrid();
      if(list.length === 0 && page===1){
        empty.style.display='block';
      }else{
        empty.style.display='none';
        const fr = document.createDocumentFragment();
        list.forEach(a => fr.appendChild(makeCard(a)));
        grid.appendChild(fr);
      }

      // Ø§Ù„ÙƒØ´Ù Ø¥Ù† ÙƒÙ†Ù‘Ø§ ÙˆØµÙ„Ù†Ø§ Ù„Ù„Ù†Ù‡Ø§ÙŠØ© (ØªØ¨Ø³ÙŠØ·Ù‹Ø§: Ø¥Ø°Ø§ Ø±Ø¬Ø¹ Ø£Ù‚Ù„ Ù…Ù† 20 Ø¹Ù†ØµØ±Ù‹Ø§)
      if(list.length < 20){ done = true; }
      setStatus('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«');
    }catch(err){
      console.error(err);
      setStatus(err.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£', 'err');
      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„ÙˆÙ‡Ù…ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„Ø®Ø·Ø£
      grid.querySelectorAll('.card .sk-img, .card .sk-text').forEach(el => el.closest('.card')?.remove());
      if(grid.children.length===0){
        const demo = [
          { title:'Ø¹Ø±Ø¶ ØªØ¬Ø±ÙŠØ¨ÙŠ â€” Ø¨Ø·Ø§Ù‚Ø© Ø®Ø¨Ø±',
            description:'Ù‡Ø°Ù‡ Ø¨Ø·Ø§Ù‚Ø© Ù„ØªÙˆØ¶ÙŠØ­ Ø§Ù„ØªØµÙ…ÙŠÙ… ÙÙ‚Ø·. Ø£Ø¯Ø®Ù„ Ù…ÙØ§ØªÙŠØ­ API Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„Ø¬Ù„Ø¨ Ø£Ø®Ø¨Ø§Ø± Ø­Ù‚ÙŠÙ‚ÙŠØ©.',
            url:'#', image:'', source:'Demo', published:new Date().toISOString() }
        ];
        const fr = document.createDocumentFragment();
        demo.forEach(a => fr.appendChild(makeCard(a)));
        grid.appendChild(fr);
      }
    }finally{
      loading = false;
    }
  }

  function resetAndSearch(){
    page = 1; done = false; clearGrid(); fetchNews(false);
  }

  // ========= ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø­Ø« =========
  searchBtn.onclick = resetAndSearch;
  providerSel.onchange = resetAndSearch;
  catSel.onchange = resetAndSearch;
  qInput.addEventListener('keydown', e => { if(e.key==='Enter') resetAndSearch(); });

  // ========= Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù„Ø§Ù†Ù‡Ø§Ø¦ÙŠ =========
  window.addEventListener('scroll', () => {
    if(loading || done) return;
    const nearBottom = window.innerHeight + window.scrollY >= document.body.offsetHeight - 300;
    if(nearBottom){ page++; fetchNews(true); }
  });

  // ========= ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­ =========
  (function init(){
    loadSettings();
    setStatus('Ø¬Ø§Ù‡Ø²');
    resetAndSearch();
  })();
</script>
</body>
</html>
