<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø¯Ø¹Ø§Ø¡ ÙˆÙØ§Ø¶Ù„ â€” Ù„Ø¹Ø¨Ø© Ø¥ÙƒØ³-Ø£Ùˆ Ø§Ù„ÙØ§Ø®Ø±Ø©</title>
  <style>
    :root{
      --bg1:#0b0f1a; --bg2:#11182a; --fg:#eaf0ff; --muted:#9fb2d9; --acc1:#7c4dff; --acc2:#22c55e; --acc3:#f59e0b; --danger:#ef4444; --glass:rgba(255,255,255,.06);
      --shadow: 0 10px 30px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.04);
    }
    [data-theme="light"]{
      --bg1:#f6f7fb; --bg2:#ffffff; --fg:#0b1220; --muted:#5b6b8c; --acc1:#6d28d9; --acc2:#059669; --acc3:#d97706; --danger:#dc2626; --glass:rgba(0,0,0,.04);
      --shadow: 0 10px 30px rgba(0,0,0,.10), inset 0 1px 0 rgba(255,255,255,.6);
    }
    *{box-sizing:border-box}
    body{margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Kufi Arabic", "Noto Naskh Arabic", Arial, sans-serif; background: radial-gradient(1200px 800px at 70% -10%, #1b2440, transparent), linear-gradient(180deg, var(--bg1), var(--bg2)); color:var(--fg); min-height:100vh}
    .container{max-width:1100px; margin:0 auto; padding:24px}header{display:flex; flex-wrap:wrap; gap:16px; align-items:center; justify-content:space-between; margin-bottom:18px}
.brand{display:flex; align-items:center; gap:12px}
.logo{width:42px; height:42px; border-radius:14px; background:linear-gradient(135deg, var(--acc1), #4f46e5); box-shadow:var(--shadow); display:grid; place-items:center; color:white; font-weight:900}
h1{margin:0; font-size:clamp(20px, 2.5vw, 28px)}
.sub{opacity:.75; font-size:13px}

.panel{background:var(--glass); border:1px solid rgba(255,255,255,.08); border-radius:20px; padding:16px; box-shadow:var(--shadow)}
.grid{display:grid; grid-template-columns: 360px 1fr; gap:20px}
@media (max-width: 940px){ .grid{grid-template-columns:1fr;}}

.row{display:flex; flex-wrap:wrap; gap:8px; align-items:center; justify-content:space-between}
.chip{padding:10px 14px; border-radius:14px; background:transparent; border:1px solid rgba(255,255,255,.12); color:var(--fg); cursor:pointer; font-weight:600}
.chip.active{background:linear-gradient(135deg, var(--acc1), #4f46e5); border-color:transparent; color:#fff; box-shadow:0 10px 20px rgba(79,70,229,.35)}

.field{display:flex; align-items:center; gap:10px; margin:10px 0}
.field label{font-size:13px; opacity:.8}
.input{flex:1; background:rgba(0,0,0,.2); border:1px solid rgba(255,255,255,.08); padding:10px 12px; border-radius:12px; color:var(--fg)}
[data-theme="light"] .input{background:rgba(255,255,255,.85)}
select.input{cursor:pointer}

.btn{padding:10px 14px; border-radius:14px; border:1px solid rgba(255,255,255,.12); background:linear-gradient(135deg, var(--bg2), var(--bg1)); color:var(--fg); cursor:pointer; font-weight:700}
.btn.primary{background:linear-gradient(135deg, var(--acc2), #16a34a); color:#fff; border:0}
.btn.warn{background:linear-gradient(135deg, var(--danger), #b91c1c); color:#fff; border:0}
.btn.ghost{background:transparent}

/* Board */
.board{display:grid; grid-template-columns:repeat(3, 1fr); gap:14px; width:min(520px, 100%); aspect-ratio:1/1; margin-inline:auto}
.cell{position:relative; border-radius:22px; background:linear-gradient(160deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.12); box-shadow:var(--shadow); font-size:clamp(42px, 10vw, 72px); font-weight:900; display:grid; place-items:center; cursor:pointer; user-select:none; transition: transform .06s ease, box-shadow .2s ease}
.cell:hover{box-shadow:0 0 0 3px rgba(124,77,255,.35) inset}
.cell.disabled{pointer-events:none; opacity:.9}
.cell.X{color:#60a5fa}
.cell.O{color:#fb7185}
.cell.win{box-shadow:0 0 0 3px rgba(34,197,94,.65) inset !important}

.statusBar{display:flex; flex-wrap:wrap; align-items:center; justify-content:space-between; gap:10px; margin:6px 0 14px}
.status{font-weight:800}
.muted{opacity:.7}

.stats{display:grid; grid-template-columns:repeat(3,1fr); gap:10px}
.card{padding:12px; border-radius:14px; background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.1); text-align:center}
.card h4{margin:0 0 6px 0; font-size:12px; opacity:.7}
.card .big{font-size:24px; font-weight:900}

footer{margin-top:18px; text-align:center; opacity:.7; font-size:12px}

  </style>
</head>
<body>
  <div class="container" id="app" data-theme="dark">
    <header>
      <div class="brand">
        <div class="logo">XO</div>
        <div>
          <h1>Ø¯Ø¹Ø§Ø¡ ÙˆÙØ§Ø¶Ù„ â€” Ù„Ø¹Ø¨Ø© Ø¥ÙƒØ³-Ø£Ùˆ Ø§Ù„ÙØ§Ø®Ø±Ø©</h1>
          <div class="sub">Ø§Ø®ØªÙØ±: ØªØ­Ø¯ÙŠ Ø¨ÙŠÙ† Ø´Ø®ØµÙŠÙ† Ø£Ùˆ Ù„Ø§Ø¹Ø¨ ÙˆØ§Ø­Ø¯ Ø¶Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ â€¢ ØªØµÙ…ÙŠÙ… ÙØ®Ù… ÙˆØ£Ù†ÙŠÙ‚</div>
        </div>
      </div>
      <div class="row">
        <button class="btn" id="themeBtn" title="ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø³Ù…Ø©">ğŸŒ™/â˜€ï¸</button>
        <button class="btn primary" id="newBtn">Ù„Ø¹Ø¨Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
        <button class="btn warn" id="resetBtn">ØªØµÙÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
      </div>
    </header><div class="grid">
  <!-- Controls -->
  <section class="panel" style="min-height:340px">
    <div class="row" style="margin-bottom:8px">
      <div class="muted">Ø§Ù„ÙˆØ¶Ø¹</div>
      <div class="row">
        <button class="chip active" data-mode="pvp">ØªØ­Ø¯ÙŠ Ø´Ø®ØµÙŠÙ†</button>
        <button class="chip" data-mode="ai">Ù„Ø§Ø¹Ø¨ ÙˆØ§Ø­Ø¯</button>
      </div>
    </div>

    <!-- PvP names -->
    <div id="pvpBox">
      <div class="field"><label>Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ (X):</label><input id="p1Name" class="input" value="Ø¯Ø¹Ø§Ø¡" /></div>
      <div class="field"><label>Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ (O):</label><input id="p2Name" class="input" value="ÙØ§Ø¶Ù„" /></div>
    </div>

    <!-- AI options -->
    <div id="aiBox" style="display:none">
      <div class="field"><label>Ø§Ø®ØªØ± Ø§Ù„Ø±Ù…Ø²:</label>
        <select id="humanMark" class="input"><option value="X">X</option><option value="O">O</option></select>
      </div>
      <div class="field"><label>Ø£ÙˆÙ„ Ù…Ù† ÙŠØ¨Ø¯Ø£:</label>
        <select id="firstMove" class="input"><option value="human">Ø§Ù„Ù„Ø§Ø¹Ø¨</option><option value="ai">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</option></select>
      </div>
      <div class="field"><label>Ø§Ù„ØµØ¹ÙˆØ¨Ø©:</label>
        <select id="difficulty" class="input">
          <option value="easy">Ø³Ù‡Ù„</option>
          <option value="medium">Ù…ØªÙˆØ³Ø·</option>
          <option value="hard" selected>ØµØ¹Ø¨ (Ù…Ø«Ø§Ù„ÙŠ)</option>
        </select>
      </div>
      <button class="btn" id="hintBtn">ğŸ’¡ ØªÙ„Ù…ÙŠØ­</button>
    </div>

    <hr style="border:none; border-top:1px solid rgba(255,255,255,.08); margin:14px 0"/>

    <div class="stats">
      <div class="card"><h4>ÙÙˆØ²</h4><div class="big" id="wins">0</div></div>
      <div class="card"><h4>ØªØ¹Ø§Ø¯Ù„</h4><div class="big" id="draws">0</div></div>
      <div class="card"><h4>Ø®Ø³Ø§Ø±Ø©</h4><div class="big" id="losses">0</div></div>
    </div>
  </section>

  <!-- Game -->
  <section>
    <div class="statusBar">
      <div class="status" id="status">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡</div>
      <div class="muted" id="turnInfo"></div>
    </div>
    <div class="board" id="board"></div>
  </section>
</div>

<footer>Ù…ØµÙ†ÙˆØ¹ Ø¨Ø­Ø¨ â€” ÙˆØ§Ø¬Ù‡Ø© ÙØ§Ø®Ø±Ø©ØŒ Ø£ØµÙˆØ§ØªØŒ Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø­Ù„ÙŠÙ‹Ø§ØŒ ÙˆØ°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…ØªØ¯Ø±Ù‘Ø¬.</footer>

  </div>  <script>
    // ============== Utilities & Audio ==============
    const $ = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));

    function beep(freq=700, dur=.07){
      try{
        const ctx = new (window.AudioContext||window.webkitAudioContext)();
        const o = ctx.createOscillator(); const g = ctx.createGain();
        o.type = 'sine'; o.frequency.value = freq; o.connect(g); g.connect(ctx.destination);
        g.gain.setValueAtTime(.0001, ctx.currentTime);
        g.gain.exponentialRampToValueAtTime(.2, ctx.currentTime+.01);
        g.gain.exponentialRampToValueAtTime(.0001, ctx.currentTime+dur);
        o.start(); o.stop(ctx.currentTime + dur + .02);
      }catch{}
    }

    const LINES = [ [0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6] ];
    function winnerOf(b){
      for(const [a,b2,c] of LINES){
        if(b[a] && b[a]===b[b2] && b[a]===b[c]) return {w:b[a], line:[a,b2,c]};
      }
      if(b.every(Boolean)) return {w:'draw', line:[]};
      return {w:null, line:[]};
    }
    const emptyIdx = b => b.map((v,i)=>v?null:i).filter(v=>v!==null);

    function minimax(board, ai, hu, max, a=-Infinity, bt=Infinity){
      const {w} = winnerOf(board);
      if(w===ai) return {s:10};
      if(w===hu) return {s:-10};
      if(w==='draw') return {s:0};
      let best=null;
      if(max){
        let bestS=-Infinity; for(const i of emptyIdx(board)){
          board[i]=ai; const {s}=minimax(board, ai, hu, false, a, bt); board[i]=null;
          if(s>bestS){bestS=s; best=i} a=Math.max(a,bestS); if(bt<=a) break;
        } return {s:bestS, m:best};
      } else {
        let bestS=Infinity; for(const i of emptyIdx(board)){
          board[i]=hu; const {s}=minimax(board, ai, hu, true, a, bt); board[i]=null;
          if(s<bestS){bestS=s; best=i} bt=Math.min(bt,bestS); if(bt<=a) break;
        } return {s:bestS, m:best};
      }
    }

    function bestMedium(board, ai, hu){
      // win
      for(const i of emptyIdx(board)){ const c=[...board]; c[i]=ai; if(winnerOf(c).w===ai) return i }
      // block
      for(const i of emptyIdx(board)){ const c=[...board]; c[i]=hu; if(winnerOf(c).w===hu) return i }
      // center -> corners -> edges
      if(!board[4]) return 4;
      const corners=[0,2,6,8].filter(i=>!board[i]); if(corners.length) return corners[Math.floor(Math.random()*corners.length)];
      const edges=[1,3,5,7].filter(i=>!board[i]); if(edges.length) return edges[Math.floor(Math.random()*edges.length)];
      return null;
    }

    // ============== State ==============
    let mode='pvp'; // 'pvp' | 'ai'
    let board = Array(9).fill(null);
    let turn='X';
    let human='X', ai='O';
    let first='human';
    let diff='hard';
    let locked=false; // for AI thinking
    let names={ X: 'Ø¯Ø¹Ø§Ø¡', O: 'ÙØ§Ø¶Ù„' };
    let hintIndex=null;

    const score = JSON.parse(localStorage.getItem('xo_score_df')||'{"w":0,"d":0,"l":0}');

    // ============== DOM refs ==============
    const app=$('#app');
    const boardEl=$('#board');
    const statusEl=$('#status');
    const turnInfo=$('#turnInfo');
    const newBtn=$('#newBtn');
    const resetBtn=$('#resetBtn');
    const themeBtn=$('#themeBtn');
    const chips=$$('[data-mode]');
    const pvpBox=$('#pvpBox'); const aiBox=$('#aiBox');
    const p1Name=$('#p1Name'); const p2Name=$('#p2Name');
    const humanMark=$('#humanMark'); const firstMove=$('#firstMove'); const difficulty=$('#difficulty');
    const hintBtn=$('#hintBtn');
    const winsEl=$('#wins'), drawsEl=$('#draws'), lossesEl=$('#losses');

    function updateScore(){ winsEl.textContent=score.w; drawsEl.textContent=score.d; lossesEl.textContent=score.l; localStorage.setItem('xo_score_df', JSON.stringify(score)); }
    updateScore();

    // ============== UI Build ==============
    function drawBoard(){
      boardEl.innerHTML='';
      board.forEach((v,i)=>{
        const btn=document.createElement('button'); btn.className='cell'+(v?(' '+v):''); btn.dataset.idx=i; btn.textContent=v||'';
        if(locked || v) btn.classList.add('disabled');
        if(hintIndex===i && !v && mode==='ai' && !locked){ btn.style.boxShadow='0 0 0 3px rgba(245,158,11,.65) inset' }
        btn.addEventListener('click', onCellClick);
        boardEl.appendChild(btn);
      })
    }

    function setStatus(txt){ statusEl.textContent = txt }
    function setTurnInfo(){
      if(mode==='pvp'){
        const who = (turn==='X'? (p1Name.value||'Ù„Ø§Ø¹Ø¨ X') : (p2Name.value||'Ù„Ø§Ø¹Ø¨ O'));
        turnInfo.textContent = `Ø¯ÙˆØ±: ${who} (${turn})`;
      } else {
        const who = (turn===human? 'Ø§Ù„Ù„Ø§Ø¹Ø¨' : 'Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ');
        turnInfo.textContent = `Ø§Ù„Ø¯ÙˆØ±: ${who} (${turn})`;
      }
    }

    function highlight(line){
      line.forEach(i=>{ const c=boardEl.querySelector(`[data-idx="${i}"]`); if(c) c.classList.add('win') })
    }

    function newGame(){
      board = Array(9).fill(null); hintIndex=null; locked=false;
      if(mode==='pvp'){
        turn='X'; names={ X: p1Name.value||'Ø¯Ø¹Ø§Ø¡', O: p2Name.value||'ÙØ§Ø¶Ù„' };
      } else {
        human = humanMark.value; ai = (human==='X'?'O':'X'); first = firstMove.value; diff = difficulty.value; turn = (first==='human'? human : ai);
      }
      drawBoard(); setTurnInfo(); setStatus('Ø­Ø¸Ù‹Ø§ Ù…ÙˆÙÙ‚Ù‹Ø§!');
      if(mode==='ai' && turn===ai){ locked=true; setStatus('Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙŠÙÙƒÙ‘Ø±â€¦'); setTimeout(aiPlay, 300) }
    }

    function resetAll(){ score.w=0; score.d=0; score.l=0; updateScore(); newGame(); }

    // ============== Game Logic ==============
    function onCellClick(e){
      const i=+e.currentTarget.dataset.idx;
      if(board[i] || locked) return;
      board[i]=turn; beep(turn==='X'?740:560, .06); drawBoard();
      const {w, line} = winnerOf(board);
      if(w){
        endGame(w, line); return;
      }
      turn = (turn==='X'?'O':'X'); setTurnInfo();
      if(mode==='ai' && turn===ai){ locked=true; setStatus('Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙŠÙÙƒÙ‘Ø±â€¦'); setTimeout(aiPlay, 300) }
    }

    function endGame(w, line){
      if(line && line.length) highlight(line);
      if(w==='draw'){ setStatus('ØªØ¹Ø§Ø¯Ù„!'); score.d++; }
      else{
        if(mode==='pvp'){
          const winnerName = (w==='X'? (p1Name.value||'Ù„Ø§Ø¹Ø¨ X') : (p2Name.value||'Ù„Ø§Ø¹Ø¨ O'));
          setStatus('ÙÙˆØ²: '+winnerName+` (${w})`);
        } else {
          setStatus(w===human? 'ÙØ²Øª!': 'ÙØ§Ø² Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ');
          if(w===human) score.w++; else score.l++;
        }
      }
      updateScore();
      // disable
      locked=true; $$('.cell').forEach(c=>c.classList.add('disabled'));
      beep(w==='draw'?500:(w==='X'?900:300), .09);
    }

    function aiPlay(){
      if(winnerOf(board).w) return; // already finished
      const move = chooseAIMove();
      if(move!==null && board[move]===null){ board[move]=ai }
      drawBoard(); locked=false; setTurnInfo();
      const {w,line}=winnerOf(board);
      if(w){ endGame(w,line); return; }
      turn=human; setStatus('Ø¯ÙˆØ±Ùƒ!');
    }

    function chooseAIMove(){
      const empties = emptyIdx(board); if(!empties.length) return null;
      if(diff==='easy') return empties[Math.floor(Math.random()*empties.length)];
      if(diff==='medium') return bestMedium(board, ai, human);
      const {m} = minimax([...board], ai, human, true); return m ?? empties[0];
    }

    function showHint(){ if(mode!=='ai' || locked) return; const {m} = minimax([...board], human, ai, true); hintIndex = m ?? null; drawBoard(); setTimeout(()=>{ hintIndex=null; drawBoard() }, 1600); beep(800,.05) }

    // ============== Events ==============
    newBtn.addEventListener('click', newGame);
    resetBtn.addEventListener('click', resetAll);
    themeBtn.addEventListener('click', ()=>{ app.dataset.theme = app.dataset.theme==='dark'?'light':'dark' });

    chips.forEach(ch=>{
      ch.addEventListener('click', ()=>{
        chips.forEach(c=>c.classList.remove('active'));
        ch.classList.add('active');
        mode=ch.dataset.mode; if(mode==='pvp'){ pvpBox.style.display='block'; aiBox.style.display='none' } else { pvpBox.style.display='none'; aiBox.style.display='block' }
        newGame();
      })
    })

    [p1Name,p2Name,humanMark,firstMove,difficulty].forEach(el=> el.addEventListener('change', newGame));
    hintBtn.addEventListener('click', showHint);

    // Init
    newGame();
  </script></body>
</html>
